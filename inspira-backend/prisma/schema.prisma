generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        Int       @id @default(autoincrement())
  email     String    @unique
  password  String
  name      String
  role      String
  grade     String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  studentProgress StudentProgress[]
  classes        Class[]          @relation("TeacherClasses")
  quizResults    QuizResult[]
  achievements   Achievement[]
  assignments    Assignment[]     @relation("TeacherAssignments")
}

model StudentProgress {
  id                  Int      @id @default(autoincrement())
  userId              Int
  subject             String
  activitiesCompleted Int
  totalActivities     Int
  points              Int
  // Store badges as JSON string (e.g. '["badge1","badge2"]')
  badgesJson          String
  currentLevel        Int
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  user User @relation(fields: [userId], references: [id])
}

model Class {
  id           Int      @id @default(autoincrement())
  teacherId    Int
  className    String
  grade        String
  subject      String?
  description  String?
  studentCount Int
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  teacher User @relation("TeacherClasses", fields: [teacherId], references: [id])
}

model Activity {
  id                   Int      @id @default(autoincrement())
  subject              String
  title                String
  description          String?
  gradeLevel           String
  activityType         String
  difficulty           String
  pointsReward         Int
  estimatedTimeMinutes Int?
  // Store activity content as JSON string
  contentJson          String
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  quizResults QuizResult[]
}

model QuizResult {
  id               Int      @id @default(autoincrement())
  userId           Int
  activityId       Int
  score            Int
  maxScore         Int
  timeTakenSeconds Int?
  // Store answers as JSON string
  answersJson      String
  pointsEarned     Int
  completedAt      DateTime @default(now())

  user     User     @relation(fields: [userId], references: [id])
  activity Activity @relation(fields: [activityId], references: [id])
}

model Achievement {
  id              Int      @id @default(autoincrement())
  userId          Int
  achievementType String
  achievementName String
  achievementIcon String?
  subject         String?
  earnedAt        DateTime @default(now())

  user User @relation(fields: [userId], references: [id])
}

model Assignment {
  id          Int      @id @default(autoincrement())
  teacherId   Int
  title       String
  type        String   // "assignment" or "notice"
  subject     String
  targetGrade String
  content     String
  attachment  String?
  createdAt   DateTime @default(now())

  teacher User @relation("TeacherAssignments", fields: [teacherId], references: [id])
}